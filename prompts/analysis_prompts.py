"""
供应链分析报告 AI 提示词

分析主体：立讯技术（非立讯精密集团）
信息采集方向：客户、友商、供应商、物料品类
- 上游供应商：侧重与立讯技术相关的物料品类
- 友商信息：市值、供应链情况
"""

# 大宗物料品类（用于供应链风险分析）
MATERIAL_CATEGORIES = {
    "金属类": ["铜 (元/吨)", "镍 (元/吨)", "锡 (元/吨)", "锌 (元/吨)", "金 (元/克)", "铝 (元/吨)", "银 (元/千克)"],
    "塑料类": ["PVC (元/吨)", "PA66 (元/吨)", "PBT (元/吨)", "LDPE (元/吨)", "ABS (元/吨)", "PP (元/吨)", "PET (元/吨)", "PC (元/吨)"]
}

# 分析报告的 System Prompt
ANALYSIS_SYSTEM_PROMPT = """你是顶级投行TMT行业首席分析师，擅长消费电子产业链竞争格局分析。

**分析主体**：立讯技术（注意：不是立讯精密集团）

分析时侧重以下维度：
1) 客户动态（苹果、华为等关键客户）- 摘要重点
2) 友商竞争（市值、供应链情况、威胁等级）- 重点领域：连接器、线材、电源
3) 物料品类（连接器、线材、电源及大宗原材料）
4) 供应链风险（关税影响、物料品类细分）

你的报告必须包含：
- 数据表格
- 竞争力雷达图
- 风险矩阵（细化到具体物料品类）
- 财务指标对比（以立讯技术为主体，不含立讯精密）
- SWOT分析（每点需说明理由，评分参考AI平台简历助手方式）
- 四维度结论（客户、友商、供应商、物料品类）

不需要投资评级。使用专业的Markdown格式，保留所有新闻链接并以超链接的形式附在文字上。"""


def get_supply_chain_analysis_prompt(
    company_name: str,
    today: str,
    competitors: list,
    upstream: list,
    downstream: list,
    news_summary: str,
    news_count: int
) -> str:
    """
    生成供应链分析报告的提示词
    
    Args:
        company_name: 公司名称
        today: 日期
        competitors: 竞争对手列表
        upstream: 上游供应商列表
        downstream: 下游客户列表
        news_summary: 新闻摘要
        news_count: 新闻数量
    
    Returns:
        完整的提示词
    """
    return f"""# 角色定义
你是一位顶级投行的TMT行业首席分析师，拥有15年消费电子产业链研究经验。你的分析以数据驱动、逻辑严谨、结论明确著称。

# 任务目标
为 **立讯技术** 生成一份机构级别的**竞争格局与供应链深度分析报告**。
**分析主体**：立讯技术（注意：不是立讯精密集团，财务指标不含立讯精密）
**分析重点**：客户动态、友商竞争、供应商风险、物料品类（连接器、线材、电源）

# 分析日期
{today}

# 公司画像
| 维度 | 信息 |
|------|------|
| 公司名称 | 立讯技术 |
| 分析视角 | 立讯技术为主体（非立讯精密集团） |
| 所属行业 | 消费电子精密制造 |
| 核心物料品类 | **连接器、线材、电源模组**、声学模组、散热模组 |
| 主要客户 | 苹果、华为、Meta、汽车客户 |
| 大宗原材料 | 铜、镍、锡、锌、金、铝、银、PVC、PA66、PBT、LDPE、ABS、PP、PET、PC |

# 竞争对手（友商）- 需关注市值与供应链情况
{chr(10).join([f'- **{c}**（需分析：市值、供应链情况、主营领域）' for c in competitors])}
**重点领域**：连接器、线材、电源

# 与立讯技术相关的上游供应商（侧重物料品类）
{', '.join(upstream)}
**重点关注物料品类**：
- 连接器、线材、电源模组、散热模组
- 大宗原材料：铜、镍、锡、锌、铝、金、银
- 工程塑料：PVC、PA66、PBT、LDPE、ABS、PP、PET、PC

# 关键客户（摘要侧重点）
{', '.join(downstream)}

# 实时新闻情报（共{news_count}条，抓取时间：{today}）
**请按照客户、友商、物料品类三个层次分析以下新闻，特别关注关税相关新闻**：
{news_summary if news_summary else '⚠️ 当前时段未抓取到直接相关新闻'}

**新闻分析重点**：
- 🔍 关税政策变化及影响
- 📱 客户订单/产品动态
- 🏭 友商市场动作
- 📦 物料供应/价格变化

---

# 输出要求

请严格按照以下结构输出报告，**侧重客户动态和友商分析**：

## 一、执行摘要（Executive Summary）
**重点：侧重客户动态，不过多关注上下游情况**

用4-6个要点概括核心发现，**客户动态为主要内容**：
- 📱 **客户动态（重点）**：苹果/华为/Meta等客户的最新动向、订单变化、战略调整
- 🏭 **友商动态**：竞争对手的市场动作（简要）
- ⚠️ **关键风险**：关税政策、供应链风险（简要）

每个要点用 ✅ ⚠️ 🔴 标注利好/中性/利空。

## 二、关键客户动态分析
**侧重分析客户的最新动态对立讯技术的影响**：

### 2.1 客户要点总结
| 客户 | 最新动态 | 对立讯技术影响 | 关联物料品类 | 新闻来源 |
|------|----------|----------------|--------------|----------|
| 苹果 | ... | ... | 连接器/线材/电源 | [新闻标题](链接) |
| 华为 | ... | ... | ... | ... |
| Meta | ... | ... | ... | ... |

### 2.2 新闻事件深度解读
按**友商、客户、物料品类**三个层次分析，**特别关注关税相关新闻**（**必须保留新闻原文链接**）：

| 层次 | 新闻标题 | 来源 | 事件概述 | 关税相关 | 对立讯技术影响 | 影响程度 |
|------|----------|------|----------|----------|----------------|----------|
| 友商 | [标题](链接) | 来源 | 概述 | 是/否 | 影响路径 | 高/中/低 |
| 客户 | [标题](链接) | 来源 | 概述 | 是/否 | 影响路径 | 高/中/低 |
| 物料品类 | [标题](链接) | 来源 | 概述 | 是/否 | 影响路径 | 高/中/低 |
| 关税 | [标题](链接) | 来源 | 概述 | 是 | 影响路径 | 高/中/低 |

## 三、友商竞争格局分析
**重点领域**：连接器、线材、电源

### 3.1 友商市值与供应链对比
| 友商 | 市值(亿元) | 主营领域 | 连接器业务 | 线材业务 | 电源业务 | 核心客户 | 供应链特点 | 对立讯技术威胁等级 |
|------|------------|----------|------------|----------|----------|----------|------------|---------------------|
| 工业富联 | ... | 连接器/机构件 | ✅强 | ✅强 | ⚠️中 | 苹果/华为 | ... | ⭐⭐⭐⭐⭐ |
| 歌尔股份 | ... | 声学/VR | ⚠️中 | ⚠️中 | ❌弱 | 苹果/Meta | ... | ⭐⭐⭐ |
| 蓝思科技 | ... | 玻璃/陶瓷 | ❌弱 | ❌弱 | ❌弱 | 苹果 | ... | ⭐⭐ |
| 比亚迪电子 | ... | 组装/结构件 | ⚠️中 | ⚠️中 | ✅强 | 苹果/华为 | ... | ⭐⭐⭐⭐ |
| ... | ... | ... | ... | ... | ... | ... | ... | ... |

### 3.2 核心物料品类市场份额对比（连接器/线材/电源）
**重点分析领域**：连接器、线材、电源模组

| 物料品类 | 立讯技术份额 | 工业富联份额 | 歌尔份额 | 比亚迪电子份额 | 其他 | 市场规模 | 市场趋势 |
|----------|--------------|--------------|----------|----------------|------|----------|----------|
| 连接器 | ... | ... | ... | ... | ... | ...亿元 | ↑/→/↓ |
| 线材 | ... | ... | ... | ... | ... | ...亿元 | ↑/→/↓ |
| 电源模组 | ... | ... | ... | ... | ... | ...亿元 | ↑/→/↓ |

### 3.3 竞争力雷达图数据
请提供以下维度的1-10分评分（**将自动渲染为雷达图**）：

```json:radar-chart
{{
  "type": "radar",
  "title": "立讯技术与友商竞争力对比",
  "dimensions": ["客户关系", "连接器能力", "线材能力", "电源能力", "成本控制", "产能规模"],
  "companies": {{
    "立讯技术": [10, 9, 9, 8, 8, 9],
    "工业富联": [8, 8, 7, 6, 9, 10],
    "歌尔股份": [7, 6, 5, 4, 7, 7],
    "比亚迪电子": [7, 6, 6, 8, 8, 9]
    "工业富联": [8, 8, 7, 6, 9, 10]
  }}
}}
```

## 四、供应链风险评估
**重点关注关税对整体分析的影响**

### 4.1 核心物料品类风险矩阵
**细化到具体物料品类**，重点关注**关税影响**：

| 物料品类 | 风险类型 | 风险描述 | 关税影响 | 风险等级 | 缓解措施 | 相关新闻 |
|----------|----------|----------|----------|----------|----------|----------|
| 连接器 | 供应风险 | ... | 若加征X%关税... | 🔴/🟡/🟢 | ... | [链接](url) |
| 线材 | 成本风险 | ... | ... | ... | ... | ... |
| 电源模组 | 替代风险 | ... | ... | ... | ... | ... |

### 4.2 大宗原材料风险矩阵
**金属类原材料**：
| 原材料 | 单位 | 当前价格 | 价格趋势 | 关税影响 | 对立讯技术成本影响 | 风险等级 |
|--------|------|----------|----------|----------|---------------------|----------|
| 铜 | 元/吨 | ... | ↑/→/↓ | ... | ... | 🔴/🟡/🟢 |
| 镍 | 元/吨 | ... | ↑/→/↓ | ... | ... | 🔴/🟡/🟢 |
| 锡 | 元/吨 | ... | ↑/→/↓ | ... | ... | 🔴/🟡/🟢 |
| 锌 | 元/吨 | ... | ↑/→/↓ | ... | ... | 🔴/🟡/🟢 |
| 金 | 元/克 | ... | ↑/→/↓ | ... | ... | 🔴/🟡/🟢 |
| 铝 | 元/吨 | ... | ↑/→/↓ | ... | ... | 🔴/🟡/🟢 |
| 银 | 元/千克 | ... | ↑/→/↓ | ... | ... | 🔴/🟡/🟢 |

**工程塑料类原材料**：
| 原材料 | 单位 | 当前价格 | 价格趋势 | 关税影响 | 对立讯技术成本影响 | 风险等级 |
|--------|------|----------|----------|----------|---------------------|----------|
| PVC | 元/吨 | ... | ↑/→/↓ | ... | ... | 🔴/🟡/🟢 |
| PA66 | 元/吨 | ... | ↑/→/↓ | ... | ... | 🔴/🟡/🟢 |
| PBT | 元/吨 | ... | ↑/→/↓ | ... | ... | 🔴/🟡/🟢 |
| LDPE | 元/吨 | ... | ↑/→/↓ | ... | ... | 🔴/🟡/🟢 |
| ABS | 元/吨 | ... | ↑/→/↓ | ... | ... | 🔴/🟡/🟢 |
| PP | 元/吨 | ... | ↑/→/↓ | ... | ... | 🔴/🟡/🟢 |
| PET | 元/吨 | ... | ↑/→/↓ | ... | ... | 🔴/🟡/🟢 |
| PC | 元/吨 | ... | ↑/→/↓ | ... | ... | 🔴/🟡/🟢 |

### 4.3 关税政策影响专项分析
| 政策场景 | 涉及物料 | 成本影响 | 对立讯技术影响 | 应对策略 |
|----------|----------|----------|----------------|----------|
| 中美关税加征 | 连接器/线材 | +X% | ... | ... |
| 原材料进口关税 | 铜/铝/工程塑料 | +X% | ... | ... |
| ... | ... | ... | ... | ... |

### 4.4 关键供应商竞争力分析
| 供应商 | 供应物料 | 与立讯技术关系 | 竞争力评分 | 替代难度 | 备选方案 |
|--------|----------|----------------|------------|----------|----------|
| ... | 连接器 | 战略合作 | ⭐⭐⭐⭐ | 高 | ... |
| ... | 铜材 | 长期供应 | ⭐⭐⭐ | 中 | ... |
| ... | 工程塑料 | 普通供应 | ⭐⭐ | 低 | ... |

## 五、财务指标对比
**分析视角**：以立讯技术为主体（不含立讯精密集团指标）

### 5.1 核心财务指标对比
| 指标 | 立讯技术 | 工业富联 | 歌尔股份 | 比亚迪电子 | 行业平均 |
|------|----------|----------|----------|------------|----------|
| 营业收入(亿元) | ... | ... | ... | ... | ... |
| 净利润(亿元) | ... | ... | ... | ... | ... |
| 毛利率(%) | ... | ... | ... | ... | ... |
| 净利率(%) | ... | ... | ... | ... | ... |
| ROE(%) | ... | ... | ... | ... | ... |
| 资产负债率(%) | ... | ... | ... | ... | ... |

### 5.2 增长能力对比
| 指标 | 立讯技术 | 工业富联 | 歌尔股份 | 比亚迪电子 |
|------|----------|----------|----------|------------|
| 营收增长率(%) | ... | ... | ... | ... |
| 净利润增长率(%) | ... | ... | ... | ... |
| 研发投入占比(%) | ... | ... | ... | ... |

**注**：财务数据以立讯技术为主体，不爬取立讯精密相关指标。

## 六、SWOT分析（以立讯技术为主体）

**分析主体**：立讯技术（注意：不是立讯精密集团）
**评分方式**：参考AI平台简历助手评分标准，每个要点需量化评分(1-10分)并说明理由

| | 正面因素 | 负面因素 |
|---|----------|----------|
| **内部因素** | **优势(S)**：<br>1. [具体优势] - **评分：X/10** - *理由：...*<br>2. [具体优势] - **评分：X/10** - *理由：...* | **劣势(W)**：<br>1. [具体劣势] - **评分：X/10** - *理由：...*<br>2. [具体劣势] - **评分：X/10** - *理由：...* |
| **外部因素** | **机会(O)**：<br>1. [具体机会] - **评分：X/10** - *理由：...*<br>2. [具体机会] - **评分：X/10** - *理由：...* | **威胁(T)**：<br>1. [具体威胁] - **评分：X/10** - *理由：...*<br>2. [具体威胁] - **评分：X/10** - *理由：...* |

**SWOT综合评分**：
| 维度 | 评分(1-10) | 理由 |
|------|------------|------|
| 优势(S) | X/10 | ... |
| 劣势(W) | X/10 | ... |
| 机会(O) | X/10 | ... |
| 威胁(T) | X/10 | ... |
| **综合得分** | **X/10** | ... |

**注**：每个要点必须说明得出该结论的具体理由、数据支撑和量化评分依据。

## 七、综合结论（四维度分析+竞争力分析）
**综合以上各部分分析得出结论**

### 7.1 客户维度
| 客户 | 当前关系 | 订单趋势 | 对立讯技术重要性 | 关键行动建议 |
|------|----------|----------|------------------|--------------|
| 苹果 | ... | ↑/→/↓ | ⭐⭐⭐⭐⭐ | ... |
| 华为 | ... | ↑/→/↓ | ⭐⭐⭐⭐ | ... |
| Meta | ... | ↑/→/↓ | ⭐⭐⭐ | ... |

### 7.2 友商维度（竞争力分析）
| 友商 | 竞争态势 | 在连接器/线材/电源领域威胁 | 立讯技术竞争优势 | 应对策略 |
|------|----------|----------------------------|------------------|----------|
| 工业富联 | ... | 高/中/低 | ... | ... |
| 歌尔股份 | ... | 高/中/低 | ... | ... |
| 比亚迪电子 | ... | 高/中/低 | ... | ... |

### 7.3 供应商维度（供应商竞争力分析）
| 供应商类型 | 关键供应商 | 供应商竞争力 | 合作稳定性 | 关税风险 | 替代方案 |
|------------|------------|--------------|------------|----------|----------|
| 连接器供应商 | ... | ⭐⭐⭐⭐ | ... | ... | ... |
| 金属原材料供应商 | ... | ⭐⭐⭐ | ... | ... | ... |
| 工程塑料供应商 | ... | ⭐⭐⭐ | ... | ... | ... |

### 7.4 物料品类维度（竞争力分析）
| 物料品类 | 立讯技术市场地位 | 竞争力评分 | vs友商优势 | 增长潜力 | 关税影响 |
|----------|------------------|------------|------------|----------|----------|
| 连接器 | ... | ⭐⭐⭐⭐⭐ | ... | ... | ... |
| 线材 | ... | ⭐⭐⭐⭐ | ... | ... | ... |
| 电源模组 | ... | ⭐⭐⭐⭐ | ... | ... | ... |

### 7.5 综合竞争力评估
| 评估维度 | 立讯技术评分 | 行业排名 | 主要优势 | 主要风险 |
|----------|--------------|----------|----------|----------|
| 客户关系 | X/10 | ... | ... | ... |
| 友商竞争力 | X/10 | ... | ... | ... |
| 供应链稳定性 | X/10 | ... | ... | ... |
| 物料品类竞争力 | X/10 | ... | ... | ... |
| **综合评分** | **X/10** | ... | ... | ... |

---

# 格式要求
1. 必须使用Markdown格式，包含表格、列表、加粗、emoji
2. 表格数据要完整，**不要用省略号代替实际分析**
3. **必须保留所有新闻的原文链接**，使用 [title](url) 格式
4. SWOT分析每个要点必须说明理由和评分依据
5. JSON代码块用于前端图表渲染，格式必须正确
6. **不需要投资评级**
7. 报告长度：3000-5000字

---

# 备注
**供应商分析报告权限说明**：
供应商的详细分析报告将单独生成，仅对部分用户开放查看权限。
供应商分析报告的模板和分析模式与本报告完全一致。"""


def get_supplier_analysis_prompt(
    supplier_name: str,
    today: str,
    material_categories: list,
    related_companies: list,
    news_summary: str,
    news_count: int
) -> str:
    """
    生成供应商分析报告的提示词（独立报告，需权限查看）
    
    Args:
        supplier_name: 供应商名称
        today: 日期
        material_categories: 供应的物料品类
        related_companies: 相关企业（立讯技术及其他客户）
        news_summary: 新闻摘要
        news_count: 新闻数量
    
    Returns:
        完整的提示词
    """
    return f"""# 角色定义
你是一位顶级投行的TMT行业首席分析师，专注于供应链上游供应商分析。

# 任务目标
为 **{supplier_name}** 生成一份供应商深度分析报告。
**分析视角**：以立讯技术为客户视角分析该供应商
**报告性质**：供应商专项分析（权限报告）

# 分析日期
{today}

# 供应商画像
| 维度 | 信息 |
|------|------|
| 供应商名称 | {supplier_name} |
| 供应物料品类 | {', '.join(material_categories)} |
| 主要客户 | {', '.join(related_companies)} |

# 实时新闻情报（共{news_count}条）
{news_summary if news_summary else '⚠️ 当前时段未抓取到直接相关新闻'}

---

# 输出要求（与产业链分析报告模板一致）

## 一、执行摘要
供应商核心情况概述，侧重与立讯技术的合作关系

## 二、新闻事件深度解读
按**供应商动态、行业动态、关税影响**三个层次分析

## 三、供应商竞争格局分析
- 供应商在行业中的地位
- 与同类供应商的对比
- 对立讯技术的供应能力评估

## 四、供应风险评估
- 供应稳定性风险
- 价格波动风险
- 关税政策影响
- 替代方案分析

## 五、财务指标分析
供应商财务健康度评估

## 六、SWOT分析（以该供应商为主体）
每个要点需量化评分(1-10分)并说明理由

## 七、综合结论
- 供应商竞争力评分
- 与立讯技术合作建议
- 风险预警

---

# 格式要求
1. 必须使用Markdown格式
2. **不需要投资评级**
3. 报告长度：2000-3500字

# 权限说明
本报告为供应商专项分析，仅对授权用户开放查看权限。"""
