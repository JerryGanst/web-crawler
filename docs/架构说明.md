# TrendRadar 架构说明

## 系统总览

```
┌─────────────────────────────────────────────────────────────┐
│                        用户界面                              │
├──────────────────────────────┬──────────────────────────────┤
│  React 前端                   │   CLI 命令行                  │
│  frontend/                   │   main.py                     │
│  端口: 5173                   │   批量爬取/定时推送            │
└──────────────────────────────┴──────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    server.py (FastAPI)                       │
│                    端口: 8000                                │
├─────────────────────────────────────────────────────────────┤
│  /api/news/{category}    新闻数据                            │
│  /api/data               大宗商品                            │
│  /api/news/supply-chain  供应链新闻                          │
│  /api/generate-analysis  AI 分析                             │
│  /api/cache/status       缓存状态                            │
└─────────────────────────────────────────────────────────────┘
                              │
          ┌───────────────────┼───────────────────┐
          ▼                   ▼                   ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│   scrapers/     │  │    pacong/      │  │     core/       │
│   国内爬虫       │  │   高级爬虫       │  │    核心模块      │
├─────────────────┤  ├─────────────────┤  ├─────────────────┤
│ unified.py      │  │ browser/        │  │ config.py       │
│ finance.py      │  │  └ applescript  │  │ analyzer.py     │
│ commodity.py    │  │  └ selenium     │  │ statistics.py   │
│ smm.py          │  │  └ cdp          │  │ notifiers/      │
│                 │  │ scrapers/       │  │ reporters/      │
│ 特点: requests  │  │  └ bloomberg    │  │                 │
│ 适用: 国内站点  │  │  └ 世界银行      │  │                 │
└─────────────────┘  └─────────────────┘  └─────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      数据存储层                              │
├───────────────────┬───────────────────┬─────────────────────┤
│  Redis (缓存)      │  MySQL (持久化)    │  SQLite (轻量)      │
│  端口: 49907      │  database/mysql/  │  本地文件            │
│  TTL: 1小时       │                   │                     │
└───────────────────┴───────────────────┴─────────────────────┘
```

## 目录职责

| 目录 | 职责 | 说明 |
|------|------|------|
| `scrapers/` | 国内财经爬虫 | 基于 requests，快速简单 |
| `pacong/` | 高级爬虫 | 支持 AppleScript/Selenium/CDP 浏览器控制 |
| `core/` | 核心模块 | 配置、分析、统计、推送 |
| `database/` | 数据库层 | MySQL 连接和仓库 |
| `config/` | 配置文件 | YAML 配置 |
| `frontend/` | React 前端 | 供应链面板、数据看板 |

## 两套爬虫对比

| 特性 | scrapers/ | pacong/ |
|------|-----------|---------|
| 实现方式 | requests | 浏览器自动化 |
| 适用场景 | 国内财经站点 | 反爬站点/国际网站 |
| 速度 | 快 | 慢但可靠 |
| 依赖 | 轻量 | 需要 Chrome |

## 配置文件

| 文件 | 用途 |
|------|------|
| `config/config.yaml` | 主配置（API密钥、推送渠道） |
| `config/scrapers.yaml` | 爬虫数据源定义 |
| `pacong/config/settings.yaml` | 高级爬虫配置 |

## 启动方式

```bash
# API 服务
python server.py          # http://localhost:8000

# React 前端
cd frontend
npm run dev               # http://localhost:5173

# CLI 爬取
python main.py

# 高级爬虫
python pacong/main.py
```